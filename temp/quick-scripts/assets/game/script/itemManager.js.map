{"version":3,"sources":["itemManager.js"],"names":["mvs","require","GLB","cc","Class","extends","Component","properties","itemPrefabs","Prefab","onLoad","Game","ItemManager","clientEvent","on","eventType","roundStart","scheduleSpawnItem","roundOver","clearScheduleSpawn","gameOver","isRoomOwner","clearInterval","scheduleSpawn","setInterval","GameManager","gameState","GameState","Over","index","dataFunc","randomNum","length","position","v2","msg","action","NEW_ITEM_EVENT","itemIndex","sendEventEx","bind","spawnItemNotify","cpProto","item","destroy","instantiate","parent","node","gamePanel","uiFunc","findUI","gamePanelScript","getComponent","nodeDict","onDestroy","off"],"mappings":";;;;;;AAAA,IAAIA,MAAMC,QAAQ,SAAR,CAAV;AACA,IAAIC,MAAMD,QAAQ,KAAR,CAAV;;AAEAE,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,qBAAa,CAACL,GAAGM,MAAJ;AADL,KAHP;;AAOLC,UAPK,oBAOI;AACLC,aAAKC,WAAL,GAAmB,IAAnB;AACAC,oBAAYC,EAAZ,CAAeD,YAAYE,SAAZ,CAAsBC,UAArC,EAAiD,KAAKC,iBAAtD,EAAyE,IAAzE;AACAJ,oBAAYC,EAAZ,CAAeD,YAAYE,SAAZ,CAAsBG,SAArC,EAAgD,KAAKC,kBAArD,EAAyE,IAAzE;AACAN,oBAAYC,EAAZ,CAAeD,YAAYE,SAAZ,CAAsBK,QAArC,EAA+C,KAAKD,kBAApD,EAAwE,IAAxE;AAEH,KAbI;;;AAeLA,wBAAoB,8BAAW;AAC3B,YAAIjB,IAAImB,WAAR,EAAqB;AACjBC,0BAAc,KAAKC,aAAnB;AACH;AACJ,KAnBI;;AAqBLN,uBAAmB,6BAAW;AAC1B,YAAIf,IAAImB,WAAR,EAAqB;AACjBC,0BAAc,KAAKC,aAAnB;AACA,iBAAKA,aAAL,GAAqBC,YAAY,YAAW;AACxC,oBAAIb,KAAKc,WAAL,CAAiBC,SAAjB,KAA+BC,UAAUC,IAA7C,EAAmD;AAC/CN,kCAAc,KAAKC,aAAnB;AACA;AACH;AACD,oBAAIM,QAAQC,SAASC,SAAT,CAAmB,CAAnB,EAAsB,KAAKvB,WAAL,CAAiBwB,MAAjB,GAA0B,CAAhD,CAAZ;AACA,oBAAIC,WAAW9B,GAAG+B,EAAH,CAAM,CAAN,EAASJ,SAASC,SAAT,CAAmB,CAAC,GAApB,EAAyB,GAAzB,CAAT,CAAf;AACA,oBAAII,MAAM;AACNC,4BAAQlC,IAAImC,cADN;AAENC,+BAAWT,KAFL;AAGNI,8BAAUA;AAHJ,iBAAV;AAKAtB,qBAAKc,WAAL,CAAiBc,WAAjB,CAA6BJ,GAA7B;AACH,aAbgC,CAa/BK,IAb+B,CAa1B,IAb0B,CAAZ,EAaP,IAbO,CAArB;AAcH;AACJ,KAvCI;;AAyCLC,qBAAiB,yBAASC,OAAT,EAAkB;AAC/B,YAAI,KAAKC,IAAT,EAAe;AACX,iBAAKA,IAAL,CAAUC,OAAV;AACH;AACD,aAAKD,IAAL,GAAYxC,GAAG0C,WAAH,CAAe,KAAKrC,WAAL,CAAiBkC,QAAQJ,SAAzB,CAAf,CAAZ;AACA,aAAKK,IAAL,CAAUG,MAAV,GAAmB,KAAKC,IAAxB;AACA,YAAIC,YAAYC,OAAOC,MAAP,CAAc,aAAd,CAAhB;AACA,YAAIF,SAAJ,EAAe;AACX,gBAAIG,kBAAkBH,UAAUI,YAAV,CAAuB,aAAvB,CAAtB;AACA,gBAAID,eAAJ,EAAqB;AACjB,oBAAIL,SAASK,gBAAgBE,QAAhB,CAAyB,YAAzB,CAAb;AACA,qBAAKV,IAAL,CAAUG,MAAV,GAAmBA,MAAnB;AACA,qBAAKH,IAAL,CAAUV,QAAV,GAAqBS,QAAQT,QAA7B;AACH;AACJ;AACJ,KAxDI;;AA0DLqB,eAAW,qBAAW;AAClBzC,oBAAY0C,GAAZ,CAAgB1C,YAAYE,SAAZ,CAAsBC,UAAtC,EAAkD,KAAKC,iBAAvD,EAA0E,IAA1E;AACAJ,oBAAY0C,GAAZ,CAAgB1C,YAAYE,SAAZ,CAAsBG,SAAtC,EAAiD,KAAKC,kBAAtD,EAA0E,IAA1E;AACAN,oBAAY0C,GAAZ,CAAgB1C,YAAYE,SAAZ,CAAsBK,QAAtC,EAAgD,KAAKD,kBAArD,EAAyE,IAAzE;AACH;AA9DI,CAAT","file":"itemManager.js","sourceRoot":"../../../../../assets/game/script","sourcesContent":["var mvs = require(\"Matchvs\");\nvar GLB = require(\"Glb\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        itemPrefabs: [cc.Prefab]\n    },\n\n    onLoad() {\n        Game.ItemManager = this;\n        clientEvent.on(clientEvent.eventType.roundStart, this.scheduleSpawnItem, this);\n        clientEvent.on(clientEvent.eventType.roundOver, this.clearScheduleSpawn, this);\n        clientEvent.on(clientEvent.eventType.gameOver, this.clearScheduleSpawn, this);\n\n    },\n\n    clearScheduleSpawn: function() {\n        if (GLB.isRoomOwner) {\n            clearInterval(this.scheduleSpawn);\n        }\n    },\n\n    scheduleSpawnItem: function() {\n        if (GLB.isRoomOwner) {\n            clearInterval(this.scheduleSpawn);\n            this.scheduleSpawn = setInterval(function() {\n                if (Game.GameManager.gameState === GameState.Over) {\n                    clearInterval(this.scheduleSpawn);\n                    return;\n                }\n                var index = dataFunc.randomNum(0, this.itemPrefabs.length - 1);\n                var position = cc.v2(0, dataFunc.randomNum(-450, 350));\n                var msg = {\n                    action: GLB.NEW_ITEM_EVENT,\n                    itemIndex: index,\n                    position: position\n                };\n                Game.GameManager.sendEventEx(msg);\n            }.bind(this), 5000);\n        }\n    },\n\n    spawnItemNotify: function(cpProto) {\n        if (this.item) {\n            this.item.destroy();\n        }\n        this.item = cc.instantiate(this.itemPrefabs[cpProto.itemIndex]);\n        this.item.parent = this.node;\n        var gamePanel = uiFunc.findUI(\"uiGamePanel\");\n        if (gamePanel) {\n            var gamePanelScript = gamePanel.getComponent(\"uiGamePanel\");\n            if (gamePanelScript) {\n                var parent = gamePanelScript.nodeDict[\"itemParent\"];\n                this.item.parent = parent;\n                this.item.position = cpProto.position;\n            }\n        }\n    },\n\n    onDestroy: function() {\n        clientEvent.off(clientEvent.eventType.roundStart, this.scheduleSpawnItem, this);\n        clientEvent.off(clientEvent.eventType.roundOver, this.clearScheduleSpawn, this);\n        clientEvent.off(clientEvent.eventType.gameOver, this.clearScheduleSpawn, this);\n    }\n});\n"]}