{"version":3,"sources":["../../../../../assets/game/script/assets/game/script/player.js"],"names":["mvs","require","GLB","cc","Class","extends","Component","properties","playerSp","default","type","Sprite","shieldSp","explosionSp","diedEffect","Node","firePoint","smokePrefab","Prefab","deadClip","url","AudioClip","_camp","Camp","None","camp","get","set","value","onLoad","initPlayerFrame","spriteFrame","init","userId","gravity","currentSpeed","flySpeed","ceilY","groundY","isShield","isTrack","active","node","anim","getComponent","Animation","isDied","beChicken","update","dt","y","play","getItem","itemType","msg","action","PLAYER_GET_ITEM_EVENT","playerId","Game","GameManager","sendEventEx","getItemNotify","cpProto","ItemType","Shield","setShield","Track","setTrack","removeItem","PLAYER_REMOVE_ITEM_EVENT","removeItemNotify","hurt","murderId","PLAYER_HURT_EVENT","hurtNotify","gameState","GameState","Play","dead","audioEngine","Math","abs","setTimeout","bind","clientEvent","dispatch","eventType","playerDead","Id","flyNotify","smoke","instantiate","worldPos","convertToWorldSpaceAR","v2","localPos","parent","convertToNodeSpaceAR","position","fireNotify","bulletPointY","BulletManager","spawnBullet"],"mappings":"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","file":"player.js","sourceRoot":"../../../../../assets/game/script","sourcesContent":["var mvs = require(\"Matchvs\");\nvar GLB = require(\"Glb\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        playerSp: {\n            default: null,\n            type: cc.Sprite\n        },\n        shieldSp: {\n            default: null,\n            type: cc.Sprite\n        },\n        explosionSp: {\n            default: null,\n            type: cc.Sprite\n        },\n        diedEffect: {\n            default: null,\n            type: cc.Node\n        },\n        firePoint: {\n            default: null,\n            type: cc.Node\n        },\n        smokePrefab: {\n            default: null,\n            type: cc.Prefab\n        },\n        deadClip: {\n            default: null,\n            url: cc.AudioClip\n        },\n        _camp: Camp.None,\n        camp: {\n            get() {\n                return this._camp;\n            },\n            set(value) {\n                this._camp = value;\n            },\n            type: Camp\n        }\n    },\n\n    onLoad: function() {\n        this.initPlayerFrame = this.playerSp.spriteFrame;\n    },\n\n    init: function(userId) {\n        this.gravity = 1500;\n        this.currentSpeed = 0;\n        this.flySpeed = 600;\n        this.ceilY = 430;\n        this.groundY = -580;\n        this.userId = userId;\n        this.isShield = false;\n        this.isTrack = false;\n        this.diedEffect.active = false;\n        this.shieldSp.node.active = false;\n        this.explosionSp.node.active = false;\n        this.playerSp.spriteFrame = this.initPlayerFrame;\n        this.anim = this.node.getComponent(cc.Animation);\n        this.isDied = false;\n        this.beChicken = false;\n    },\n\n    update: function(dt) {\n        this.currentSpeed -= dt * this.gravity;\n        this.node.y += dt * this.currentSpeed;\n        if (this.node.y < this.groundY) {\n            this.node.y = this.groundY;\n            if (this.isDied && !this.beChicken) {\n                this.beChicken = true;\n                this.anim.play(\"chicken\");\n            }\n        }\n        if (this.node.y > this.ceilY) {\n            this.node.y = this.ceilY;\n            this.currentSpeed = 0;\n        }\n    },\n\n    getItem: function(itemType) {\n        var msg = {\n            action: GLB.PLAYER_GET_ITEM_EVENT,\n            itemType: itemType,\n            playerId: this.userId\n        };\n        Game.GameManager.sendEventEx(msg);\n    },\n\n    getItemNotify: function(cpProto) {\n        var itemType = cpProto.itemType;\n        switch (itemType) {\n            case ItemType.Shield:\n                this.setShield(true);\n                break;\n            case ItemType.Track:\n                this.setTrack(true);\n                break;\n            default:\n                break;\n        }\n    },\n\n    setShield: function(active) {\n        this.isShield = active;\n        this.shieldSp.node.active = active;\n    },\n\n    setTrack: function(active) {\n        this.isTrack = active;\n    },\n\n    removeItem: function(itemType) {\n        var msg = {\n            action: GLB.PLAYER_REMOVE_ITEM_EVENT,\n            itemType: itemType\n        };\n        Game.GameManager.sendEventEx(msg);\n    },\n\n    removeItemNotify: function(cpProto) {\n        var itemType = cpProto.itemType;\n        switch (itemType) {\n            case ItemType.Shield:\n                this.setShield(false);\n                break;\n            case ItemType.Track:\n                this.setTrack(false);\n                break;\n            default:\n                break;\n        }\n    },\n\n    hurt: function(murderId) {\n        var msg = {\n            action: GLB.PLAYER_HURT_EVENT,\n            playerId: this.userId,\n            murderId: murderId\n        };\n        Game.GameManager.sendEventEx(msg);\n    },\n\n    hurtNotify: function(murderId) {\n        if (Game.GameManager.gameState !== GameState.Play) {\n            return;\n        }\n\n        if (this.isShield) {\n            this.setShield(false);\n        } else {\n            this.dead(murderId);\n        }\n    },\n\n    dead: function(murderId) {\n        this.isDied = true;\n\n        this.shieldSp.node.active = false;\n        this.anim.play('dead');\n        cc.audioEngine.play(this.deadClip, false, 1);\n        this.currentSpeed = -1000;\n        if (Math.abs(this.node.y - this.groundY) < 5) {\n            if (this.isDied && !this.beChicken) {\n                this.beChicken = true;\n                setTimeout(function() {\n                    this.anim.play(\"chicken\");\n                }.bind(this), 1000);\n            }\n        }\n        clientEvent.dispatch(clientEvent.eventType.playerDead, { Id: this.userId, murderId: murderId });\n    },\n\n    flyNotify: function() {\n        if (this.isDied === true) {\n            return;\n        }\n        this.currentSpeed = this.flySpeed;\n        this.anim.play();\n        // smoke\n        var smoke = cc.instantiate(this.smokePrefab);\n        if (smoke) {\n            var worldPos = this.node.convertToWorldSpaceAR(cc.v2(0, -30));\n            var localPos = this.node.parent.convertToNodeSpaceAR(worldPos);\n            smoke.parent = this.node.parent;\n            smoke.position = localPos;\n        }\n    },\n\n    fireNotify: function(bulletPointY) {\n        if (this.isDied) {\n            return;\n        }\n        Game.BulletManager.spawnBullet(this, bulletPointY);\n    }\n});\n"]}